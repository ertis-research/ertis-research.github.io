{{ define "main" }}
{{ $css := resources.Get "css/landing_gallery.css" }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<section class="py-8 px-4 mx-auto max-w-screen-xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 min-h-screen">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
  <h1 class="text-4xl tracking-tight font-extrabold text-center mb-8 text-gray-900 dark:text-white">{{ .Title }}</h1>
  <p class="text-center mb-12 text-gray-700 dark:text-gray-300 max-w-2xl mx-auto">{{ .Content | markdownify }}</p>
  
  {{ $slides := slice }}
  {{ range .Site.RegularPages }}
    {{ if eq .Section "gallery" }}
      {{ $slides = $slides | append . }}
    {{ end }}
  {{ end }}
  
  <div class="relative max-w-4xl mx-auto">
    <div class="gallery-carousel-container overflow-hidden">
      <div id="gallery-carousel" class="gallery-carousel flex transition-transform duration-500 ease-in-out">
        {{ range $index, $page := $slides }}
          <div class="gallery-slide flex-shrink-0 w-full" data-index="{{ $index }}">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg border-l-6 border-orange-500 mx-auto max-w-2xl">
              {{ $imageCount := len $page.Params.images }}
              <div class="grid {{ if eq $imageCount 1 }}grid-cols-1{{ else if eq $imageCount 2 }}grid-cols-2{{ else }}grid-cols-3{{ end }} gap-2 mb-6 images-{{ $imageCount }}">
                {{ range $page.Params.images }}
                  {{ $Img := resources.Get .filename }}
                  {{ if $Img }}
                  <a class="glightbox" href="{{ $Img.RelPermalink }}" data-gallery="gallery-{{ $index }}">
                    <img src="{{ $Img.RelPermalink }}" alt="{{ $page.Title }}" class="w-full object-cover rounded-lg gallery-image">
                  </a>
                  {{ end }}
                {{ end }}
              </div>
              <h2 class="text-3xl font-semibold mb-4 text-gray-900 dark:text-white">{{ $page.Title }}</h2>
              <p class="text-gray-700 dark:text-gray-300 mb-4 text-lg">{{ $page.Params.description }}</p>
              <small class="text-gray-500 dark:text-gray-400">{{ $page.Params.dates }}</small>
              {{ if $page.Params.tags }}
                <div class="mt-4 flex flex-wrap gap-2">
                  {{ range $page.Params.tags }}
                    <span class="inline-block bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 text-sm px-3 py-1 rounded-full">{{ . }}</span>
                  {{ end }}
                </div>
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
    </div>
    
    <button id="prev-btn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-orange-500 text-white p-4 rounded-full shadow-lg hover:bg-orange-600 transition z-10 text-2xl font-bold">‹</button>
    <button id="next-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-orange-500 text-white p-4 rounded-full shadow-lg hover:bg-orange-600 transition z-10 text-2xl font-bold">›</button>
    
    <div id="carousel-indicators" class="flex justify-center mt-6 space-x-3">
      {{ range $index, $page := $slides }}
        <span class="carousel-dot w-3 h-3 rounded-full bg-gray-400 dark:bg-gray-600 hover:bg-orange-400 transition" data-index="{{ $index }}"></span>
      {{ end }}
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.getElementById('gallery-carousel');
  const slides = carousel.querySelectorAll('.gallery-slide');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const dots = document.querySelectorAll('.carousel-dot');
  let currentIndex = 0;

  function showSlide(index) {
    const offset = -index * 100;
    carousel.style.transform = `translateX(${offset}%)`;
    
    dots.forEach((dot, i) => {
      if (i === index) {
        dot.classList.add('bg-orange-500');
        dot.classList.remove('bg-gray-400', 'dark:bg-gray-600');
      } else {
        dot.classList.remove('bg-orange-500');
        dot.classList.add('bg-gray-400');
      }
    });
  }

  prevBtn.addEventListener('click', function() {
    currentIndex = (currentIndex > 0) ? currentIndex - 1 : slides.length - 1;
    showSlide(currentIndex);
  });

  nextBtn.addEventListener('click', function() {
    currentIndex = (currentIndex < slides.length - 1) ? currentIndex + 1 : 0;
    showSlide(currentIndex);
  });

  dots.forEach((dot, index) => {
    dot.addEventListener('click', function() {
      currentIndex = index;
      showSlide(currentIndex);
    });
  });

  showSlide(currentIndex);
});

document.addEventListener("DOMContentLoaded", function() {
      const lightbox = GLightbox({
        selector: '.glightbox',
        touchNavigation: true,
        loop: true,
        scrollLock: false
      });
    });
</script>
{{ end }}